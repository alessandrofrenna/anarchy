#!/bin/bash

# Original reference https://github.com/basecamp/omarchy/blob/dev/bin/omarchy-cmd-terminal-cwd
# ======================================================================================
# Based on Omarchy script: omarchy-cmd-terminal-cwd
# Based on Omarchi pull request: https://github.com/basecamp/omarchy/pull/1421
# ======================================================================================

# Go from current active terminal to its child shell process and run cwd there
readonly window_class=$(hyprctl activewindow | awk '/class:/ {print $2}')
readonly terminal_pid=$(hyprctl activewindow | awk '/pid:/ {print $2}')
readonly shell_pid=$(pgrep -P "$terminal_pid" | head -n1)
notify-send "$window_class - $terminal_pid - $shell_pid" -t 10000

# Needed to prevent other application using the terminal emulator to run.
if [[ -n $shell_pid ]]; then
  readlink -f "/proc/$shell_pid/cwd" 2>/dev/null
else
  echo "$HOME"
fi