#!/bin/bash

# Original reference https://github.com/basecamp/omarchy/blob/dev/bin/omarchy-menu-power
# ======================================================================================
# Based on Omarchy script: omarchy-menu-power
# ======================================================================================

# First, check if Rofi is running. If it is, kill it and exit.
if pgrep -x rofi >/dev/null; then
    pkill -x rofi
    exit 0
fi

selection=$(uwsm app -- rofi -show power-menu -modi "power-menu:${HOME}/.local/share/anarchy/default/scripts/power-menu-options" \
             -theme-str 'element { children: [element-text]; } inputbar {  enabled: false; } window { width: 250; }')

case "$selection" in
*Logout*) uwsm stop ;;
*Lock*) hyprlock ;;
*Suspend*) systemctl suspend-then-hibernate &>/dev/null || systemctl suspend ;;
*Hibernate*) systemctl hibernate &>/dev/null || systemctl suspend ;;
*Restart*) systemctl reboot ;;
*Shutdown*) systemctl poweroff ;;
esac